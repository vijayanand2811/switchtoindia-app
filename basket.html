<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Basket — Switch To India</title>
<link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div class="wrap">
<header>
  <div class="logo">
    <div class="badge" aria-hidden>
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden>
        <path d="M3 3h2l1 7h13l1-5H8" stroke="#111" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
        <circle cx="10" cy="20" r="1.6" fill="#111"/>
        <circle cx="18" cy="20" r="1.6" fill="#111"/>
      </svg>
    </div>
    <h1>Switch To India</h1>
  </div>
  <nav>
    <a href="index.html">Home</a>
    <a href="blog.html">Blog</a>
    <a href="basket.html">Basket</a>
  </nav>
</header>

<!-- HERO (same as index) -->
<section class="hero" role="banner" aria-label="Hero">
  <h2>Discover who owns the brands you buy — and switch to Indian alternatives.</h2>
  <p>Type a product, scan a barcode later, and see instant Indian alternatives. Minimal. Fast. Neutral.</p>

  <div class="search" style="margin-top:8px; display:flex; gap:8px; max-width:640px;">
  <input id="searchBoxHero" placeholder="Type a product (e.g., noodles, soap)" aria-label="Search product" style="flex:1;padding:12px;border-radius:10px;border:1px solid #eee" />
  <button class="btn btn-primary" onclick="doSearchFromHero()" style="padding:10px 16px;">Search</button>
  <button class="btn btn-ghost" onclick="openExample()" style="padding:10px 16px;">Try Example</button>
</div>

</section>

<main>
  <h2>Your Basket</h2>
  <div id="basketItems" class="card" style="min-height:60px"></div>
  <div style="margin-top:14px" class="card">
    <h4>Impact Summary</h4>
    <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap">
      <canvas id="pieChart" width="160" height="160"></canvas>
      <div id="impactText" class="small"></div>
    </div>
  </div>
  <div style="margin-top:14px" class="card">
    <button class="btn btn-primary" onclick="clearBasket()">Clear Basket</button>
    <button class="btn btn-ghost" onclick="shareScore()">Share Score</button>
  </div>
</main>

<footer>
  <div class="small">Tip: add items from results → then return here to view your Indian vs Foreign split.</div>
</footer>
</div>

<script src="app.js"></script>
<script>
<script>
function clearBasket(){
  try {
    localStorage.removeItem('stindiabasket_v1');
    localStorage.removeItem('basket');
    if (typeof loadBasket === 'function') loadBasket();
    if (typeof clearChart === 'function') clearChart();
    if (typeof showToast === 'function') showToast('Basket cleared');
    else alert('Basket cleared');
  } catch (e) {
    console.error('clearBasket error', e);
    alert('Could not clear basket — see console for details.');
  }
}

function shareScore(){
  // Compose message
  const stats = document.getElementById('impactText')?.innerText?.trim() || '';
  const site = (window.location.origin || 'https://switchtoindia.in');
  const url = site + '/'; // root (or change to basket.html or results)
  const prefix = 'My Indian score from SwitchToIndia:';
  const message = stats ? `${prefix} ${stats} — See alternatives & try it: ${url}` : `Check your SwitchToIndia score: ${url}`;

  // Preferred: use Web Share API where supported (mobile)
  if (navigator.share) {
    navigator.share({
      title: 'My Indian Score — SwitchToIndia',
      text: message,
      url: url
    }).catch(err => {
      // user cancelled or other error; fallback to clipboard
      console.info('Share API error or cancelled', err);
    });
    return;
  }

  // Fallback: copy full message to clipboard
  if (navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(message).then(() => {
      alert('Score copied to clipboard. Paste it in any chat to share!');
    }).catch(() => {
      // fallback to prompt if clipboard fails
      prompt('Copy and share this message:', message);
    });
    return;
  }

  // Final fallback: prompt with text
  prompt('Copy and share this message:', message);
}

window.addEventListener('DOMContentLoaded', function(){
  if (typeof loadBasket === 'function') loadBasket();
});
</script>

window.addEventListener('DOMContentLoaded', function(){ if(typeof loadBasket==='function') loadBasket(); });
</script>


<script>
  function doSearchFromHero(){
    const q = (document.getElementById('searchBoxHero') || {}).value || '';
    if (!q.trim()) { alert('Type a product name to search.'); return; }
    window.location.href = 'results.html?q=' + encodeURIComponent(q.trim());
  }

  function openExample(){ window.location.href = 'results.html?q=maggi'; }
</script>
</body>
</html>
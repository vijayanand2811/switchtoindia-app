<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Basket — Switch To India</title>
<link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div class="wrap">
<header>
  <div class="logo">
    <div class="badge" aria-hidden>
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden>
        <path d="M3 3h2l1 7h13l1-5H8" stroke="#111" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
        <circle cx="10" cy="20" r="1.6" fill="#111"/>
        <circle cx="18" cy="20" r="1.6" fill="#111"/>
      </svg>
    </div>
    <h1>Switch To India</h1>
  </div>
  <nav>
    <a href="index.html">Home</a>
    <a href="blog.html">Blog</a>
    <a href="basket.html">Basket</a>
  </nav>
</header>

<!-- HERO (same as index) -->
<section class="hero" role="banner" aria-label="Hero">
  <h2>Discover who owns the brands you buy — and switch to Indian alternatives.</h2>
  <p>Type a product, scan a barcode later, and see instant Indian alternatives. Minimal. Fast. Neutral.</p>

  <div class="search" style="margin-top:8px; display:flex; gap:8px; max-width:640px;">
  <input id="searchBoxHero" placeholder="Type a product (e.g., noodles, soap)" aria-label="Search product" style="flex:1;padding:12px;border-radius:10px;border:1px solid #eee" />
  <button class="btn btn-primary" onclick="doSearchFromHero()" style="padding:10px 16px;">Search</button>
  <button class="btn btn-ghost" onclick="openExample()" style="padding:10px 16px;">Try Example</button>
</div>

</section>

<main>
  <h2>Your Basket</h2>
  <div id="basketItems" class="card" style="min-height:60px"></div>
  <div style="margin-top:14px" class="card">
    <h4>Impact Summary</h4>
    <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap">
      <canvas id="pieChart" width="160" height="160"></canvas>
      <div id="impactText" class="small"></div>
    </div>
  </div>
  <div style="margin-top:14px" class="card">
    <button class="btn btn-primary" onclick="clearBasket()">Clear Basket</button>
    <button class="btn btn-ghost" onclick="shareScore()">Share Score</button>
  </div>
</main>

<footer>
  <div class="small">Tip: add items from results → then return here to view your Indian vs Foreign split.</div>
</footer>
</div>

<script src="app.js"></script>

<script>
function clearBasket(){
  try {
    localStorage.removeItem('stindiabasket_v1');
    localStorage.removeItem('basket');
    if (typeof loadBasket === 'function') loadBasket();
    if (typeof clearChart === 'function') clearChart();
    if (typeof showToast === 'function') showToast('Basket cleared');
    else alert('Basket cleared');
  } catch (e) {
    console.error('clearBasket error', e);
    alert('Could not clear basket — see console for details.');
  }
}

<script>
/* Replace ONLY the shareScore() function with this. Keep other scripts (clearBasket/loadBasket) as-is. */
function shareScore(){
  // build friendly message
  const stats = (document.getElementById('impactText') || {}).innerText || '';
  const origin = window.location.origin || 'https://switchtoindia.in';
  const url = origin + '/';
  const prefix = 'My Indian score from SwitchToIndia:';
  const message = stats ? `${prefix} ${stats} — Try it: ${url}` : `Check your SwitchToIndia score: ${url}`;

  // Try Web Share API first (mobile); wrap in try/catch
  if (navigator.share) {
    try {
      navigator.share({ title: 'My Indian Score — SwitchToIndia', text: message, url })
        .then(() => { /* shared successfully */ })
        .catch(err => {
          // If user cancels or share fails, fallback to copying message
          console.info('navigator.share failed or cancelled:', err);
          tryCopy();
        });
      return;
    } catch (e) {
      console.error('navigator.share exception:', e);
      // continue to fallback
    }
  }

  // fallback: try to copy to clipboard, then alert user
  function tryCopy(){
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(message).then(() => {
        alert('Score copied to clipboard — paste it in any chat to share!');
      }).catch(err => {
        console.error('clipboard.writeText failed', err);
        // final fallback
        prompt('Copy and share this message:', message);
      });
    } else {
      // last resort
      prompt('Copy and share this message:', message);
    }
  }

  // If we reached here (no navigator.share), try copy flow
  tryCopy();
}
</script>


<script>
  function doSearchFromHero(){
    const q = (document.getElementById('searchBoxHero') || {}).value || '';
    if (!q.trim()) { alert('Type a product name to search.'); return; }
    window.location.href = 'results.html?q=' + encodeURIComponent(q.trim());
  }

  function openExample(){ window.location.href = 'results.html?q=maggi'; }
</script>
</body>
</html>